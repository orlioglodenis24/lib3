{% extends 'base.html' %}
{% load static %}
{% block title %}–ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥ ‚Äî –ß–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∏–π –¥–Ω–µ–≤–Ω–∏–∫{% endblock %}

{% block content %}
<section class="catalog">
  <h2 class="catalog__title">–ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥</h2>

  <div class="catalog__wrapper">

    <!-- Sidebar —Ñ–∏–ª—å—Ç—Ä—ã -->
    <aside class="catalog__filters-sidebar">
      <form method="GET" action="{% url 'catalog' %}" id="filter-form" class="filter-form">

        <div class="filter-form__group">
          <label for="search" class="filter-form__label">üîç –ü–æ–∏—Å–∫</label>
          <input
            type="search"
            id="search"
            name="q"
            value="{{ request.GET.q|default:'' }}"
            placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –∞–≤—Ç–æ—Ä"
            class="filter-form__input"
            autocomplete="off"
          />
        </div>

        <div class="filter-form__group">
          <label for="genre" class="filter-form__label">üìö –ñ–∞–Ω—Ä</label>
          <select name="genre" id="genre" class="filter-form__select" title="–í—ã–±–µ—Ä–∏—Ç–µ –∂–∞–Ω—Ä">
            <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
            {% for genre in genres %}
              <option value="{{ genre.id }}" {% if genre.id|stringformat:"s" == request.GET.genre %}selected{% endif %}>{{ genre.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="filter-form__group">
          <label for="author" class="filter-form__label">‚úçÔ∏è –ê–≤—Ç–æ—Ä</label>
          <select name="author" id="author" class="filter-form__select" title="–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ—Ä–∞">
            <option value="">–í—Å–µ –∞–≤—Ç–æ—Ä—ã</option>
            {% for author in authors %}
              <option value="{{ author.id }}" {% if author.id|stringformat:"s" == request.GET.author %}selected{% endif %}>{{ author.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="filter-form__group">
          <label for="year" class="filter-form__label">üìÖ –ì–æ–¥ –∏–∑–¥–∞–Ω–∏—è</label>
          <input
            type="number"
            name="year"
            id="year"
            value="{{ request.GET.year|default:'' }}"
            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 2020"
            class="filter-form__input"
            min="1500" max="2100"
          />
        </div>

        <div class="filter-form__buttons">
          <button type="submit" class="btn btn--primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
          <a href="{% url 'catalog' %}" class="btn btn--reset">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
      </form>
    </aside>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å –∫–Ω–∏–≥–∞–º–∏ -->
    <div class="catalog__books">

      {% if books %}
        <div class="books-grid">
          {% for book in books %}
            <article class="book-card" tabindex="0" aria-label="–ö–Ω–∏–≥–∞ {{ book.title }}">
              {% if book.cover_image %}
                <img
                  src="{{ book.cover_image.url }}"
                  alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏ {{ book.title }}"
                  class="book-card__image"
                  loading="lazy"
                />
              {% else %}
                <img
                  src="{% static 'images/default_cover.jpg' %}"
                  alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏ {{ book.title }}"
                  class="book-card__image"
                  loading="lazy"
                />
              {% endif %}
              <div class="book-card__info">
                <h3 class="book-card__title">{{ book.title }}</h3>
                <p class="book-card__author">–ê–≤—Ç–æ—Ä: <a href="{% url 'genres_and_authors' %}#author-{{ book.author.id }}">{{ book.author.name }}</a></p>
                <p class="book-card__genre">–ñ–∞–Ω—Ä: <a href="{% url 'genres_and_authors' %}#genre-{{ book.genre.id }}">{{ book.genre.name }}</a></p>
                <a href="{% url 'book_detail' book.id %}" class="book-card__button" aria-label="–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∫–Ω–∏–≥–µ {{ book.title }}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
              </div>
            </article>
          {% endfor %}
        </div>
      {% else %}
        <p>–ö–Ω–∏–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
      {% endif %}

    </div>
  </div>
</section>

{% endblock %}
